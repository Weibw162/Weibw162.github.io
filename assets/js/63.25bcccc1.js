(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{400:function(t,s,a){"use strict";a.r(s);var n=a(7),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[s("code",[t._v("Flask")]),t._v(" 使用 "),s("code",[t._v("Jinja2")]),t._v(" 作为默认模板引擎。你完全可以使用其它模板引擎。但是不管你使用哪种模板引擎，都必须安装 "),s("code",[t._v("Jinja2")]),t._v(" 。因为使用 "),s("code",[t._v("Jinja2")]),t._v(" 可以让 "),s("code",[t._v("Flask")]),t._v(" 使用更多依赖于这个模板引擎的扩展。")]),t._v(" "),s("p",[t._v("本文只是简单介绍如何在 "),s("code",[t._v("Flask")]),t._v(" 中使用 "),s("code",[t._v("Jinja2")]),t._v(" 。如果要详细了解这个模板引擎的语法，请查阅 "),s("a",{attrs:{href:"https://jinja.palletsprojects.com/en/3.0.x/templates/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Jinja2 模板官方文档"),s("OutboundLink")],1),t._v(" 。")]),t._v(" "),s("h3",{attrs:{id:"_1-6-1-jinja设置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-1-jinja设置"}},[t._v("#")]),t._v(" 1.6.1 Jinja设置")]),t._v(" "),s("p",[t._v("在 "),s("code",[t._v("Flask")]),t._v(" 中，"),s("code",[t._v("Jinja2")]),t._v(" 默认配置如下：")]),t._v(" "),s("ul",[s("li",[t._v("当使用 "),s("code",[t._v("render_template()")]),t._v(" 时，扩展名为 "),s("code",[t._v(".html")]),t._v(" 、"),s("code",[t._v(".htm")]),t._v(" 、"),s("code",[t._v(".xml")]),t._v(" 和 "),s("code",[t._v(".xhtml")]),t._v(" 的模板中开启自动转义。")]),t._v(" "),s("li",[t._v("当使用 "),s("code",[t._v("render_template_string()")]),t._v(" 时，字符串开启自动转义。")]),t._v(" "),s("li",[t._v("在模板中可以使用 "),s("code",[t._v("{% autoescape %}")]),t._v(" 来手动设置是否转义。")]),t._v(" "),s("li",[s("code",[t._v("Flask")]),t._v(" 在 "),s("code",[t._v("Jinja2")]),t._v(" 环境中加入一些全局函数和辅助对象，以增强模板的功能。")])]),t._v(" "),s("h3",{attrs:{id:"_1-6-2-标准环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-2-标准环境"}},[t._v("#")]),t._v(" 1.6.2 标准环境")]),t._v(" "),s("p",[t._v("缺省情况下，以下全局变量可以在 "),s("code",[t._v("Jinja2")]),t._v(" 模板中使用：")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("config")]),t._v(" 当前配置对象（flask.Flask.config ） Changed in version 0.10: 这个变量总是可用，甚至是在被导入的模板中。 New in version 0.6.")]),t._v(" "),s("li",[s("strong",[t._v("request")]),t._v(" 当前请求对象（flask.request ）。在没有活动请求环境情况下渲染模板时，这个变量不可用。")]),t._v(" "),s("li",[s("strong",[t._v("session")]),t._v(" 当前会话对象（flask.session ）。在没有活动请求环境情况下渲染模板时，这个变量不可用。")]),t._v(" "),s("li",[s("strong",[t._v("g")]),t._v(" 请求绑定的全局变量（flask.g ）。在没有活动请求环境情况下渲染模板时，这个变量不可用。")]),t._v(" "),s("li",[s("strong",[t._v("url_for()")]),t._v(" flask.url_for() 函数。")]),t._v(" "),s("li",[s("strong",[t._v("get_flashed_messages()")]),t._v(" flask.get_flashed_messages() 函数。")])]),t._v(" "),s("hr"),t._v(" "),s("p",[s("strong",[t._v("Jinja 环境行为")])]),t._v(" "),s("p",[t._v("这些添加到环境中的变量不是全局变量。与真正的全局变量不同的是这些变量在已导入的模板的环境中是不 可见的。这样做是基于性能的原因，同时也考虑让代码更有条理。")]),t._v(" "),s("p",[t._v("那么意义何在？假设你需要导入一个宏，这个宏需要访问请求对象，那么你有两个选择：")]),t._v(" "),s("ol",[s("li",[t._v("显式地把请求或都该请求有用的属性作为参数传递给宏。")]),t._v(" "),s("li",[t._v("导入"),s("code",[t._v("“with context ”")]),t._v("宏。 导入方式如下：")])]),t._v(" "),s("div",{staticClass:"language-python line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'_helpers.html'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" my_macro "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" context "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h3",{attrs:{id:"_1-6-3-控制自动转义"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-3-控制自动转义"}},[t._v("#")]),t._v(" 1.6.3 控制自动转义")]),t._v(" "),s("p",[t._v("自动转义是指自动对特殊字符进行转义。特殊字符是指 "),s("code",[t._v("HTML")]),t._v("（或 "),s("code",[t._v("XML")]),t._v(" 和 "),s("code",[t._v("XHTML")]),t._v(" ）中的 "),s("code",[t._v("&")]),t._v(" 、"),s("code",[t._v(">")]),t._v(" 、"),s("code",[t._v("<")]),t._v(" 、"),s("code",[t._v('"')]),t._v(" 和 "),s("code",[t._v("'")]),t._v(" 。因为这些特殊字符代表了特殊的意思，所以如果要在文本中使用它们就必须把它们替换为“实体”。如果 不转义，那么用户就无法使用这些字符，而且还会带来安全问题。（参见跨站脚本攻击（XSS ） ）")]),t._v(" "),s("p",[t._v("有时候，如需要直接把 "),s("code",[t._v("HTML")]),t._v(" 植入页面的时候，可能会需要在模板中关闭自动转义功能。这个可以直接植入 的 "),s("code",[t._v("HTML")]),t._v(" 一般来自安全的来源，例如一个把标记语言转换为 "),s("code",[t._v("HTML")]),t._v(" 的转换器。")]),t._v(" "),s("p",[t._v("有三种方法可以控制自动转义：")]),t._v(" "),s("ul",[s("li",[t._v("在 "),s("code",[t._v("Python")]),t._v(" 代码中，可以在把 "),s("code",[t._v("HTML")]),t._v(" 字符串传递给模板之前，用"),s("code",[t._v("Markup")]),t._v(" 对象封装。一般情况下推荐使 用这个方法。")]),t._v(" "),s("li",[t._v("在模板中，使用 "),s("code",[t._v("|safe")]),t._v(" 过滤器显式把一个字符串标记为安全的 "),s("code",[t._v("HTML")]),t._v("（例如："),s("code",[t._v(t._s(t._f("safe")(t.myvariable)))]),t._v(" ）。")]),t._v(" "),s("li",[t._v("临时关闭整个系统的自动转义。")])]),t._v(" "),s("p",[t._v("在模板中关闭自动转义系统可以使用 "),s("code",[t._v("{% autoescape %}")]),t._v(" 块：")]),t._v(" "),s("div",{staticClass:"language-html line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[t._v("{% autoescape false %}\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("p")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("autoescaping is disabled here\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("p")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("{{ will_not_be_escaped }}\n{% endautoescape %}\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("p",[t._v("在这样做的时候，要非常小心块中的变量的安全性。")]),t._v(" "),s("h3",{attrs:{id:"_1-6-4-注册过滤器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-4-注册过滤器"}},[t._v("#")]),t._v(" 1.6.4 注册过滤器")]),t._v(" "),s("p",[t._v("有两种方法可以在 "),s("code",[t._v("Jinja2")]),t._v(" 中注册你自己的过滤器。要么手动把它们放入应用的"),s("code",[t._v("jinja_env")]),t._v(" 中，要么使 用"),s("code",[t._v("template_filter()")]),t._v(" 装饰器。")]),t._v(" "),s("p",[t._v("下面两个例子功能相同，都是倒序一个对象:")]),t._v(" "),s("div",{staticClass:"language-python line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("template_filter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'reverse'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("reverse_filter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("reverse_filter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\napp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jinja_env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filters"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'reverse'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" reverse_filter\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])]),s("p",[t._v("装饰器的参数是可选的，如果不给出就使用函数名作为过滤器名。一旦注册完成后，你就可以在模板中像 "),s("code",[t._v("Jinja2")]),t._v(" 的内建过滤器一样使用过滤器了。例如，假设在环境中你有一个名为 "),s("code",[t._v("mylist")]),t._v(" 的 "),s("code",[t._v("Pyhton")]),t._v(" 列表:")]),t._v(" "),s("div",{staticClass:"language-python line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" x "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" mylist "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" reverse "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" endfor "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("h3",{attrs:{id:"_1-6-5-环境处理器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-5-环境处理器"}},[t._v("#")]),t._v(" 1.6.5 环境处理器")]),t._v(" "),s("p",[t._v("环境处理器的作用是把新的变量自动引入模板环境中。环境处理器在模板被渲染前运行，因此可以把新的变 量自动引入模板环境中。它是一个函数，返回值是一个字典。在应用的所有模板中，这个字典将与模板环境 合并:")]),t._v(" "),s("div",{staticClass:"language-python line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("context_processor")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("inject_user")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("dict")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("user"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("g"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("p",[t._v("上例中的环境处理器创建了一个值为 "),s("code",[t._v("g.user")]),t._v(" 的 "),s("code",[t._v("user")]),t._v(" 变量，并把这个变量加入了模板环境中。这个例子只是用 于说明工作原理，不是非常有用，因为在模板中，"),s("code",[t._v("g")]),t._v(" 总是存在的。")]),t._v(" "),s("p",[t._v("传递值不仅仅局限于变量，还可以传递函数（"),s("code",[t._v("Python")]),t._v(" 提供传递函数的功能）:")]),t._v(" "),s("div",{staticClass:"language-python line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("context_processor")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("utility_processor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("format_price")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("amount"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" currency"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"€"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("amount"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token format-spec"}},[t._v(".2f")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("currency"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"')])]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("dict")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("format_price"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("format_price"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("p",[t._v("上例中的环境处理器把 "),s("code",[t._v("format_price")]),t._v(" 函数传递给了所有模板:")]),t._v(" "),s("div",{staticClass:"language-python line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" format_price"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.33")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("你还可以把 "),s("code",[t._v("format_price")]),t._v(" 创建为一个模板过滤器（参见注册过滤器 ），这里只是演示如何在一个环境处理器中 传递函数。")])])}),[],!1,null,null,null);s.default=e.exports}}]);