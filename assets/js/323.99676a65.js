(window.webpackJsonp=window.webpackJsonp||[]).push([[323],{657:function(a,s,t){"use strict";t.r(s);var n=t(7),e=Object(n.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[a._v("#")]),a._v(" 问题")]),a._v(" "),s("p",[a._v("解释器因为某个分段错误、总线错误、访问越界或其他致命错误而突然间奔溃。 你想获得Python堆栈信息，从而找出在发生错误的时候你的程序运行点。")]),a._v(" "),s("h2",{attrs:{id:"解决方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解决方案"}},[a._v("#")]),a._v(" 解决方案")]),a._v(" "),s("p",[s("code",[a._v("faulthandler")]),a._v(" 模块能被用来帮你解决这个问题。 在你的程序中引入下列代码：")]),a._v(" "),s("div",{staticClass:"language-python line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" faulthandler\nfaulthandler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("enable"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("另外还可以像下面这样使用 "),s("code",[a._v("-Xfaulthandler")]),a._v(" 来运行Python：")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v(" % python3 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Xfaulthandler")]),a._v(" program.py\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("最后，你可以设置 "),s("code",[a._v("PYTHONFAULTHANDLER")]),a._v(" 环境变量。 开启faulthandler后，在C扩展中的致命错误会导致一个Python错误堆栈被打印出来。例如：")]),a._v(" "),s("div",{staticClass:"language-c line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-c"}},[s("code",[a._v("Fatal Python error"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" Segmentation fault\n\nCurrent thread "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0x00007fff71106cc0")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n  File "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"example.py"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" line "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("6")]),a._v(" in foo\n  File "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"example.py"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" line "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v(" in bar\n  File "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"example.py"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" line "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("14")]),a._v(" in spam\n  File "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"example.py"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" line "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("19")]),a._v(" in "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("module"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\nSegmentation fault\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("p",[a._v("尽管这个并不能告诉你C代码中哪里出错了，但是至少能告诉你Python里面哪里有错。")]),a._v(" "),s("h2",{attrs:{id:"讨论"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#讨论"}},[a._v("#")]),a._v(" 讨论")]),a._v(" "),s("p",[a._v("faulthandler会在Python代码执行出错的时候向你展示跟踪信息。 至少，它会告诉你出错时被调用的最顶级扩展函数是哪个。 在pdb和其他Python调试器的帮助下，你就能追根溯源找到错误所在的位置了。")]),a._v(" "),s("p",[a._v("faulthandler不会告诉你任何C语言中的错误信息。 因此，你需要使用传统的C调试器，比如gdb。 不过，在faulthandler追踪信息可以让你去判断从哪里着手。 还要注意的是在C中某些类型的错误可能不太容易恢复。 例如，如果一个C扩展丢弃了程序堆栈信息，它会让faulthandler不可用， 那么你也得不到任何输出（除了程序奔溃外）。")])])}),[],!1,null,null,null);s.default=e.exports}}]);