<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>《面试笔记》——MySQL终结篇（30问与答） | Weibw&#39;s World</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3077305_wawne43ztng.css">
    <script language="javascript" type="text/javascript" src="/js/pgmanor-self.js"></script>
    <meta name="description" content="这一生波澜壮阔或是不惊都没问题">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="keywords" content="Python,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#646cff">
    
    <link rel="preload" href="/assets/css/0.styles.247a10b0.css" as="style"><link rel="preload" href="/assets/js/app.7df3e72d.js" as="script"><link rel="preload" href="/assets/js/2.0f973f23.js" as="script"><link rel="preload" href="/assets/js/3.004d1f99.js" as="script"><link rel="preload" href="/assets/js/41.109d26dd.js" as="script"><link rel="prefetch" href="/assets/js/10.7c8e1571.js"><link rel="prefetch" href="/assets/js/100.b641f27c.js"><link rel="prefetch" href="/assets/js/101.97fdbe28.js"><link rel="prefetch" href="/assets/js/102.f2dc82d3.js"><link rel="prefetch" href="/assets/js/103.3fcbf899.js"><link rel="prefetch" href="/assets/js/104.7c2aab32.js"><link rel="prefetch" href="/assets/js/105.58e26f41.js"><link rel="prefetch" href="/assets/js/106.058500b3.js"><link rel="prefetch" href="/assets/js/107.3893d88a.js"><link rel="prefetch" href="/assets/js/108.5c75a42d.js"><link rel="prefetch" href="/assets/js/109.5a3a9ef6.js"><link rel="prefetch" href="/assets/js/11.6c32ce25.js"><link rel="prefetch" href="/assets/js/110.816a8462.js"><link rel="prefetch" href="/assets/js/111.662a7748.js"><link rel="prefetch" href="/assets/js/112.4793ac69.js"><link rel="prefetch" href="/assets/js/113.8193f027.js"><link rel="prefetch" href="/assets/js/114.29617af4.js"><link rel="prefetch" href="/assets/js/115.db52b9f5.js"><link rel="prefetch" href="/assets/js/116.d24c2de0.js"><link rel="prefetch" href="/assets/js/117.76c83092.js"><link rel="prefetch" href="/assets/js/118.f1130142.js"><link rel="prefetch" href="/assets/js/119.9e552f02.js"><link rel="prefetch" href="/assets/js/12.c6335bd0.js"><link rel="prefetch" href="/assets/js/120.32c30027.js"><link rel="prefetch" href="/assets/js/121.c12dd8ef.js"><link rel="prefetch" href="/assets/js/122.107d001a.js"><link rel="prefetch" href="/assets/js/123.2b3d86de.js"><link rel="prefetch" href="/assets/js/124.720c26f7.js"><link rel="prefetch" href="/assets/js/125.81f5cd71.js"><link rel="prefetch" href="/assets/js/126.a09bf2d9.js"><link rel="prefetch" href="/assets/js/127.049b24af.js"><link rel="prefetch" href="/assets/js/128.5686fe09.js"><link rel="prefetch" href="/assets/js/129.5d397181.js"><link rel="prefetch" href="/assets/js/13.7cbf4917.js"><link rel="prefetch" href="/assets/js/130.5e881032.js"><link rel="prefetch" href="/assets/js/131.28b3e40f.js"><link rel="prefetch" href="/assets/js/132.af72b00b.js"><link rel="prefetch" href="/assets/js/133.f91fc73f.js"><link rel="prefetch" href="/assets/js/134.04f336fa.js"><link rel="prefetch" href="/assets/js/135.42cc068c.js"><link rel="prefetch" href="/assets/js/136.be079a4a.js"><link rel="prefetch" href="/assets/js/137.56e7ff2f.js"><link rel="prefetch" href="/assets/js/138.1a5a3d78.js"><link rel="prefetch" href="/assets/js/139.e2779bac.js"><link rel="prefetch" href="/assets/js/14.887f029b.js"><link rel="prefetch" href="/assets/js/140.e1d62467.js"><link rel="prefetch" href="/assets/js/141.f4727572.js"><link rel="prefetch" href="/assets/js/142.f628a48e.js"><link rel="prefetch" href="/assets/js/143.f9b2855d.js"><link rel="prefetch" href="/assets/js/144.dca42b85.js"><link rel="prefetch" href="/assets/js/145.14d415f4.js"><link rel="prefetch" href="/assets/js/146.56b711d3.js"><link rel="prefetch" href="/assets/js/147.e7e29d70.js"><link rel="prefetch" href="/assets/js/148.22fb6b55.js"><link rel="prefetch" href="/assets/js/149.e0815197.js"><link rel="prefetch" href="/assets/js/15.6220a806.js"><link rel="prefetch" href="/assets/js/150.ae39f883.js"><link rel="prefetch" href="/assets/js/151.be5ac292.js"><link rel="prefetch" href="/assets/js/152.185ca4c4.js"><link rel="prefetch" href="/assets/js/153.422ee4e0.js"><link rel="prefetch" href="/assets/js/154.ab4b3692.js"><link rel="prefetch" href="/assets/js/155.3f56b8d4.js"><link rel="prefetch" href="/assets/js/156.fd75d1e3.js"><link rel="prefetch" href="/assets/js/157.edfaf2b5.js"><link rel="prefetch" href="/assets/js/158.147821f4.js"><link rel="prefetch" href="/assets/js/159.2da98f51.js"><link rel="prefetch" href="/assets/js/16.2e8d3534.js"><link rel="prefetch" href="/assets/js/160.20d32d28.js"><link rel="prefetch" href="/assets/js/161.cdf070d6.js"><link rel="prefetch" href="/assets/js/162.e33a540b.js"><link rel="prefetch" href="/assets/js/163.d6350dcf.js"><link rel="prefetch" href="/assets/js/164.fc65d87e.js"><link rel="prefetch" href="/assets/js/165.ced0fe62.js"><link rel="prefetch" href="/assets/js/166.72d5218e.js"><link rel="prefetch" href="/assets/js/167.3dd68940.js"><link rel="prefetch" href="/assets/js/168.28573243.js"><link rel="prefetch" href="/assets/js/169.00beb797.js"><link rel="prefetch" href="/assets/js/17.5ccbb776.js"><link rel="prefetch" href="/assets/js/170.b352598f.js"><link rel="prefetch" href="/assets/js/171.6c73be24.js"><link rel="prefetch" href="/assets/js/172.71b9dfb7.js"><link rel="prefetch" href="/assets/js/173.0a0790ed.js"><link rel="prefetch" href="/assets/js/174.9a072c96.js"><link rel="prefetch" href="/assets/js/175.324878fa.js"><link rel="prefetch" href="/assets/js/176.ebfbb236.js"><link rel="prefetch" href="/assets/js/177.47a059ee.js"><link rel="prefetch" href="/assets/js/178.219d0707.js"><link rel="prefetch" href="/assets/js/179.6cd3c6f9.js"><link rel="prefetch" href="/assets/js/18.e7510230.js"><link rel="prefetch" href="/assets/js/180.d982f8ce.js"><link rel="prefetch" href="/assets/js/181.8b46c4a6.js"><link rel="prefetch" href="/assets/js/182.65efd6ca.js"><link rel="prefetch" href="/assets/js/183.786b72cc.js"><link rel="prefetch" href="/assets/js/184.4a9ed659.js"><link rel="prefetch" href="/assets/js/185.2f0ef6da.js"><link rel="prefetch" href="/assets/js/186.e1d8421b.js"><link rel="prefetch" href="/assets/js/187.661116b1.js"><link rel="prefetch" href="/assets/js/188.949d32fd.js"><link rel="prefetch" href="/assets/js/189.a9e472db.js"><link rel="prefetch" href="/assets/js/19.8cd43b3a.js"><link rel="prefetch" href="/assets/js/190.c8696ecd.js"><link rel="prefetch" href="/assets/js/191.4f3266af.js"><link rel="prefetch" href="/assets/js/192.1b6ba1bc.js"><link rel="prefetch" href="/assets/js/193.59e61be0.js"><link rel="prefetch" href="/assets/js/194.497b3599.js"><link rel="prefetch" href="/assets/js/195.bdf96d56.js"><link rel="prefetch" href="/assets/js/196.5981c66c.js"><link rel="prefetch" href="/assets/js/197.7184d74a.js"><link rel="prefetch" href="/assets/js/198.04ac422d.js"><link rel="prefetch" href="/assets/js/199.a0f8b0d2.js"><link rel="prefetch" href="/assets/js/20.21ca3cc8.js"><link rel="prefetch" href="/assets/js/200.4fe16c16.js"><link rel="prefetch" href="/assets/js/201.93328057.js"><link rel="prefetch" href="/assets/js/202.69b506a3.js"><link rel="prefetch" href="/assets/js/203.bd75950e.js"><link rel="prefetch" href="/assets/js/204.6aa830f9.js"><link rel="prefetch" href="/assets/js/205.ac1d6c38.js"><link rel="prefetch" href="/assets/js/206.1b25e46c.js"><link rel="prefetch" href="/assets/js/207.ee4dfe8d.js"><link rel="prefetch" href="/assets/js/208.0751d7f1.js"><link rel="prefetch" href="/assets/js/209.cb07cd11.js"><link rel="prefetch" href="/assets/js/21.49432e9f.js"><link rel="prefetch" href="/assets/js/210.3ece2306.js"><link rel="prefetch" href="/assets/js/211.60927ade.js"><link rel="prefetch" href="/assets/js/212.139c9371.js"><link rel="prefetch" href="/assets/js/213.c26b9fc0.js"><link rel="prefetch" href="/assets/js/214.8f41d3a7.js"><link rel="prefetch" href="/assets/js/215.37b3206e.js"><link rel="prefetch" href="/assets/js/216.d4815c11.js"><link rel="prefetch" href="/assets/js/217.51268bd4.js"><link rel="prefetch" href="/assets/js/218.b6ae64ab.js"><link rel="prefetch" href="/assets/js/219.c634016b.js"><link rel="prefetch" href="/assets/js/22.c0920caf.js"><link rel="prefetch" href="/assets/js/220.cb700658.js"><link rel="prefetch" href="/assets/js/221.902dacfe.js"><link rel="prefetch" href="/assets/js/222.b9580d80.js"><link rel="prefetch" href="/assets/js/223.aeee2a14.js"><link rel="prefetch" href="/assets/js/224.5f88b567.js"><link rel="prefetch" href="/assets/js/225.b8526ce0.js"><link rel="prefetch" href="/assets/js/226.e40a611a.js"><link rel="prefetch" href="/assets/js/227.3632250b.js"><link rel="prefetch" href="/assets/js/228.29604e03.js"><link rel="prefetch" href="/assets/js/229.cd80b414.js"><link rel="prefetch" href="/assets/js/23.a9feea38.js"><link rel="prefetch" href="/assets/js/230.a9465a43.js"><link rel="prefetch" href="/assets/js/231.eb86ceb2.js"><link rel="prefetch" href="/assets/js/232.8965cec5.js"><link rel="prefetch" href="/assets/js/233.a478bb3c.js"><link rel="prefetch" href="/assets/js/234.45eeeefb.js"><link rel="prefetch" href="/assets/js/235.b8b24625.js"><link rel="prefetch" href="/assets/js/236.cc6359e1.js"><link rel="prefetch" href="/assets/js/237.e64548cd.js"><link rel="prefetch" href="/assets/js/238.40caa6ae.js"><link rel="prefetch" href="/assets/js/239.04295d37.js"><link rel="prefetch" href="/assets/js/24.984b760c.js"><link rel="prefetch" href="/assets/js/240.29646fef.js"><link rel="prefetch" href="/assets/js/241.7c5eb27d.js"><link rel="prefetch" href="/assets/js/242.e3ef5afb.js"><link rel="prefetch" href="/assets/js/243.ddb92950.js"><link rel="prefetch" href="/assets/js/244.7a536e56.js"><link rel="prefetch" href="/assets/js/245.54fdd683.js"><link rel="prefetch" href="/assets/js/246.6d9be882.js"><link rel="prefetch" href="/assets/js/247.0aa3acd2.js"><link rel="prefetch" href="/assets/js/248.f6bf685b.js"><link rel="prefetch" href="/assets/js/249.cd3fc4ba.js"><link rel="prefetch" href="/assets/js/25.52c40432.js"><link rel="prefetch" href="/assets/js/250.a3989ba3.js"><link rel="prefetch" href="/assets/js/251.924aaa43.js"><link rel="prefetch" href="/assets/js/252.3d9a9982.js"><link rel="prefetch" href="/assets/js/253.ac397dbc.js"><link rel="prefetch" href="/assets/js/254.9ba827a1.js"><link rel="prefetch" href="/assets/js/255.c7c82bd0.js"><link rel="prefetch" href="/assets/js/256.b596d6ac.js"><link rel="prefetch" href="/assets/js/257.8ac69f7c.js"><link rel="prefetch" href="/assets/js/258.9db12b32.js"><link rel="prefetch" href="/assets/js/259.81941fe7.js"><link rel="prefetch" href="/assets/js/26.5a48c082.js"><link rel="prefetch" href="/assets/js/260.ef304058.js"><link rel="prefetch" href="/assets/js/261.40addb0d.js"><link rel="prefetch" href="/assets/js/262.3398b716.js"><link rel="prefetch" href="/assets/js/263.e4d81b30.js"><link rel="prefetch" href="/assets/js/264.0f8ef18d.js"><link rel="prefetch" href="/assets/js/265.0b86b8c3.js"><link rel="prefetch" href="/assets/js/266.bb4e22e1.js"><link rel="prefetch" href="/assets/js/267.1cdc8dbd.js"><link rel="prefetch" href="/assets/js/268.1729924e.js"><link rel="prefetch" href="/assets/js/269.b18c7e1b.js"><link rel="prefetch" href="/assets/js/27.5dc19001.js"><link rel="prefetch" href="/assets/js/270.414bf0d7.js"><link rel="prefetch" href="/assets/js/271.74f20361.js"><link rel="prefetch" href="/assets/js/272.bfac4267.js"><link rel="prefetch" href="/assets/js/273.974cc717.js"><link rel="prefetch" href="/assets/js/274.d9bc28b5.js"><link rel="prefetch" href="/assets/js/275.abc92e61.js"><link rel="prefetch" href="/assets/js/276.489ae67f.js"><link rel="prefetch" href="/assets/js/277.3417b370.js"><link rel="prefetch" href="/assets/js/278.fcf590f4.js"><link rel="prefetch" href="/assets/js/279.fff7a8af.js"><link rel="prefetch" href="/assets/js/28.396488e2.js"><link rel="prefetch" href="/assets/js/280.8375468a.js"><link rel="prefetch" href="/assets/js/281.3ffdfc8c.js"><link rel="prefetch" href="/assets/js/282.60c9a5f8.js"><link rel="prefetch" href="/assets/js/283.9e3e2632.js"><link rel="prefetch" href="/assets/js/284.9f093b66.js"><link rel="prefetch" href="/assets/js/285.61969650.js"><link rel="prefetch" href="/assets/js/286.dced6a7f.js"><link rel="prefetch" href="/assets/js/287.d9581c66.js"><link rel="prefetch" href="/assets/js/288.6c62afc6.js"><link rel="prefetch" href="/assets/js/289.4bc56f56.js"><link rel="prefetch" href="/assets/js/29.8a9414f2.js"><link rel="prefetch" href="/assets/js/290.b961e5dd.js"><link rel="prefetch" href="/assets/js/291.80e5a0bd.js"><link rel="prefetch" href="/assets/js/292.112e9101.js"><link rel="prefetch" href="/assets/js/293.c443387d.js"><link rel="prefetch" href="/assets/js/294.de1a993a.js"><link rel="prefetch" href="/assets/js/295.f0acbbe2.js"><link rel="prefetch" href="/assets/js/296.058d3917.js"><link rel="prefetch" href="/assets/js/297.5b2d4a23.js"><link rel="prefetch" href="/assets/js/298.c47d74ab.js"><link rel="prefetch" href="/assets/js/299.8f65bb15.js"><link rel="prefetch" href="/assets/js/30.86f84f9d.js"><link rel="prefetch" href="/assets/js/300.2d0547bc.js"><link rel="prefetch" href="/assets/js/301.e57d9634.js"><link rel="prefetch" href="/assets/js/302.cc227811.js"><link rel="prefetch" href="/assets/js/303.e2338664.js"><link rel="prefetch" href="/assets/js/304.4e6f8e31.js"><link rel="prefetch" href="/assets/js/305.8c5a1e2a.js"><link rel="prefetch" href="/assets/js/306.085c742c.js"><link rel="prefetch" href="/assets/js/307.7528f174.js"><link rel="prefetch" href="/assets/js/308.d9dd5ad4.js"><link rel="prefetch" href="/assets/js/309.3e9fa8c7.js"><link rel="prefetch" href="/assets/js/31.71ec3b7e.js"><link rel="prefetch" href="/assets/js/310.530ad00d.js"><link rel="prefetch" href="/assets/js/311.97c1965f.js"><link rel="prefetch" href="/assets/js/312.963afd13.js"><link rel="prefetch" href="/assets/js/313.1f2f545b.js"><link rel="prefetch" href="/assets/js/314.c34323d3.js"><link rel="prefetch" href="/assets/js/315.37a1105b.js"><link rel="prefetch" href="/assets/js/316.d041e09d.js"><link rel="prefetch" href="/assets/js/317.223ef09e.js"><link rel="prefetch" href="/assets/js/318.8afa9b95.js"><link rel="prefetch" href="/assets/js/319.e1c8e4e7.js"><link rel="prefetch" href="/assets/js/32.0329645e.js"><link rel="prefetch" href="/assets/js/320.a9fcaa80.js"><link rel="prefetch" href="/assets/js/321.2e20dc78.js"><link rel="prefetch" href="/assets/js/322.33d1153f.js"><link rel="prefetch" href="/assets/js/323.99676a65.js"><link rel="prefetch" href="/assets/js/324.6fb86195.js"><link rel="prefetch" href="/assets/js/325.89d1b411.js"><link rel="prefetch" href="/assets/js/326.fa6532bb.js"><link rel="prefetch" href="/assets/js/327.28c9c77d.js"><link rel="prefetch" href="/assets/js/328.01f91bd5.js"><link rel="prefetch" href="/assets/js/329.77fa1924.js"><link rel="prefetch" href="/assets/js/33.16ad0d7a.js"><link rel="prefetch" href="/assets/js/330.cc0f583c.js"><link rel="prefetch" href="/assets/js/331.fa634662.js"><link rel="prefetch" href="/assets/js/332.0da0d58a.js"><link rel="prefetch" href="/assets/js/333.83a9a8f3.js"><link rel="prefetch" href="/assets/js/334.34e5070c.js"><link rel="prefetch" href="/assets/js/335.32a0e556.js"><link rel="prefetch" href="/assets/js/336.2b81e1ac.js"><link rel="prefetch" href="/assets/js/337.fcc2b305.js"><link rel="prefetch" href="/assets/js/338.9d95cc83.js"><link rel="prefetch" href="/assets/js/339.14128e63.js"><link rel="prefetch" href="/assets/js/34.d7ed4e1e.js"><link rel="prefetch" href="/assets/js/340.9dd55b06.js"><link rel="prefetch" href="/assets/js/341.af9931e9.js"><link rel="prefetch" href="/assets/js/342.fac64a2a.js"><link rel="prefetch" href="/assets/js/343.5e2a7170.js"><link rel="prefetch" href="/assets/js/344.6af93427.js"><link rel="prefetch" href="/assets/js/345.fffff4e0.js"><link rel="prefetch" href="/assets/js/346.26ac5eb0.js"><link rel="prefetch" href="/assets/js/347.8f1ec9f2.js"><link rel="prefetch" href="/assets/js/348.3863fe61.js"><link rel="prefetch" href="/assets/js/349.cb420e0d.js"><link rel="prefetch" href="/assets/js/35.260a5d0e.js"><link rel="prefetch" href="/assets/js/350.f5988350.js"><link rel="prefetch" href="/assets/js/351.ebf4c176.js"><link rel="prefetch" href="/assets/js/352.81ee7157.js"><link rel="prefetch" href="/assets/js/353.15d7e4bc.js"><link rel="prefetch" href="/assets/js/354.1aa2bf8e.js"><link rel="prefetch" href="/assets/js/355.168f656e.js"><link rel="prefetch" href="/assets/js/356.02ee7279.js"><link rel="prefetch" href="/assets/js/357.31953379.js"><link rel="prefetch" href="/assets/js/358.31f72fb0.js"><link rel="prefetch" href="/assets/js/359.69011095.js"><link rel="prefetch" href="/assets/js/36.06b37c37.js"><link rel="prefetch" href="/assets/js/360.031be2f4.js"><link rel="prefetch" href="/assets/js/361.58c36bbc.js"><link rel="prefetch" href="/assets/js/362.7c84dd21.js"><link rel="prefetch" href="/assets/js/363.82a5016a.js"><link rel="prefetch" href="/assets/js/364.31014b05.js"><link rel="prefetch" href="/assets/js/365.a5c7e9f9.js"><link rel="prefetch" href="/assets/js/366.752ae114.js"><link rel="prefetch" href="/assets/js/367.9b793fb5.js"><link rel="prefetch" href="/assets/js/368.37ef39a8.js"><link rel="prefetch" href="/assets/js/369.46bbf02b.js"><link rel="prefetch" href="/assets/js/37.117c5279.js"><link rel="prefetch" href="/assets/js/370.c12be4a3.js"><link rel="prefetch" href="/assets/js/371.e5c5475a.js"><link rel="prefetch" href="/assets/js/38.233b852c.js"><link rel="prefetch" href="/assets/js/39.6ec07ec3.js"><link rel="prefetch" href="/assets/js/4.3a1b136c.js"><link rel="prefetch" href="/assets/js/40.749374e2.js"><link rel="prefetch" href="/assets/js/42.59854684.js"><link rel="prefetch" href="/assets/js/43.f4ba79a9.js"><link rel="prefetch" href="/assets/js/44.064604c6.js"><link rel="prefetch" href="/assets/js/45.44b9febc.js"><link rel="prefetch" href="/assets/js/46.162e1c49.js"><link rel="prefetch" href="/assets/js/47.fa2fa831.js"><link rel="prefetch" href="/assets/js/48.2a2c8504.js"><link rel="prefetch" href="/assets/js/49.d13a67c5.js"><link rel="prefetch" href="/assets/js/5.c2793df7.js"><link rel="prefetch" href="/assets/js/50.ab6a5f40.js"><link rel="prefetch" href="/assets/js/51.61489a31.js"><link rel="prefetch" href="/assets/js/52.fc60ddd6.js"><link rel="prefetch" href="/assets/js/53.39806e0a.js"><link rel="prefetch" href="/assets/js/54.4d75a7f7.js"><link rel="prefetch" href="/assets/js/55.9a328d45.js"><link rel="prefetch" href="/assets/js/56.5b3449bb.js"><link rel="prefetch" href="/assets/js/57.7f6e2a0a.js"><link rel="prefetch" href="/assets/js/58.520d140e.js"><link rel="prefetch" href="/assets/js/59.558b7f20.js"><link rel="prefetch" href="/assets/js/6.64bbf572.js"><link rel="prefetch" href="/assets/js/60.f2ead093.js"><link rel="prefetch" href="/assets/js/61.4408eb48.js"><link rel="prefetch" href="/assets/js/62.2902a46c.js"><link rel="prefetch" href="/assets/js/63.25bcccc1.js"><link rel="prefetch" href="/assets/js/64.db806e93.js"><link rel="prefetch" href="/assets/js/65.b7ae3e38.js"><link rel="prefetch" href="/assets/js/66.d9008145.js"><link rel="prefetch" href="/assets/js/67.f6c30d7e.js"><link rel="prefetch" href="/assets/js/68.0eac6b1c.js"><link rel="prefetch" href="/assets/js/69.2f54ff09.js"><link rel="prefetch" href="/assets/js/7.c2e7635b.js"><link rel="prefetch" href="/assets/js/70.1acfe2a6.js"><link rel="prefetch" href="/assets/js/71.db4bd9b5.js"><link rel="prefetch" href="/assets/js/72.f1aa5af2.js"><link rel="prefetch" href="/assets/js/73.149f8812.js"><link rel="prefetch" href="/assets/js/74.70ab992f.js"><link rel="prefetch" href="/assets/js/75.ece26af3.js"><link rel="prefetch" href="/assets/js/76.def447cb.js"><link rel="prefetch" href="/assets/js/77.501cacd5.js"><link rel="prefetch" href="/assets/js/78.8ba4915f.js"><link rel="prefetch" href="/assets/js/79.8eff8b78.js"><link rel="prefetch" href="/assets/js/8.52501d28.js"><link rel="prefetch" href="/assets/js/80.8f21dce1.js"><link rel="prefetch" href="/assets/js/81.55fe0573.js"><link rel="prefetch" href="/assets/js/82.fa3ddb54.js"><link rel="prefetch" href="/assets/js/83.cf8556b1.js"><link rel="prefetch" href="/assets/js/84.35044c55.js"><link rel="prefetch" href="/assets/js/85.cc815541.js"><link rel="prefetch" href="/assets/js/86.2d885520.js"><link rel="prefetch" href="/assets/js/87.e3a11753.js"><link rel="prefetch" href="/assets/js/88.049b058b.js"><link rel="prefetch" href="/assets/js/89.b29c1b1a.js"><link rel="prefetch" href="/assets/js/9.e12a1f1f.js"><link rel="prefetch" href="/assets/js/90.c0bad389.js"><link rel="prefetch" href="/assets/js/91.7faf6df9.js"><link rel="prefetch" href="/assets/js/92.1877de0c.js"><link rel="prefetch" href="/assets/js/93.bb03cf65.js"><link rel="prefetch" href="/assets/js/94.60fd2081.js"><link rel="prefetch" href="/assets/js/95.998d7606.js"><link rel="prefetch" href="/assets/js/96.a2fe03e8.js"><link rel="prefetch" href="/assets/js/97.2691eee5.js"><link rel="prefetch" href="/assets/js/98.6caa303b.js"><link rel="prefetch" href="/assets/js/99.85271c80.js">
    <link rel="stylesheet" href="/assets/css/0.styles.247a10b0.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Weibw's World" class="logo"> <span class="site-name can-hide">Weibw's World</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/front/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/089974/" class="nav-link">HTML</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/backend/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Python</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/python/base/" class="nav-link">Python基础知识</a></li><li class="dropdown-subitem"><a href="/python/cookbook3/" class="nav-link">Python CookBook第三版</a></li><li class="dropdown-subitem"><a href="/python/flask/" class="nav-link">Flask</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/database/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>MySQL</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/96d563/" class="nav-link">MySQL基础知识</a></li><li class="dropdown-subitem"><a href="/mysql/mysqlty/" class="nav-link">MySQL调优</a></li><li class="dropdown-subitem"><a href="/pages/5aa29a/" class="nav-link">MySQL面试题</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他技术" class="dropdown-title"><a href="/other/" class="link-title">其他技术</a> <span class="title" style="display:none;">其他技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/e52678/" class="nav-link">FineReport</a></li><li class="dropdown-item"><!----> <a href="/pages/fde6a7/" class="nav-link">Kettle</a></li><li class="dropdown-item"><!----> <a href="/study/git/" class="nav-link">Git</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/b6414a/" class="nav-link">微信公众号文章</a></li><li class="dropdown-item"><!----> <a href="/pages/e444e7/" class="nav-link">优秀博客文章</a></li><li class="dropdown-item"><!----> <a href="/pages/030cd4/" class="nav-link">其他</a></li></ul></div></div><div class="nav-item"><a href="/pages/55120e/" class="nav-link">收藏夹</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/weibw162/weibw162.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/Weibw162/image-hosting@dev/杂录/image.735febsv1zo0.webp"> <div class="blogger-info"><h3>Weibw</h3> <span>一个没有梦想的咸鱼</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/front/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/089974/" class="nav-link">HTML</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/backend/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Python</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/python/base/" class="nav-link">Python基础知识</a></li><li class="dropdown-subitem"><a href="/python/cookbook3/" class="nav-link">Python CookBook第三版</a></li><li class="dropdown-subitem"><a href="/python/flask/" class="nav-link">Flask</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/database/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>MySQL</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/96d563/" class="nav-link">MySQL基础知识</a></li><li class="dropdown-subitem"><a href="/mysql/mysqlty/" class="nav-link">MySQL调优</a></li><li class="dropdown-subitem"><a href="/pages/5aa29a/" class="nav-link">MySQL面试题</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他技术" class="dropdown-title"><a href="/other/" class="link-title">其他技术</a> <span class="title" style="display:none;">其他技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/e52678/" class="nav-link">FineReport</a></li><li class="dropdown-item"><!----> <a href="/pages/fde6a7/" class="nav-link">Kettle</a></li><li class="dropdown-item"><!----> <a href="/study/git/" class="nav-link">Git</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/b6414a/" class="nav-link">微信公众号文章</a></li><li class="dropdown-item"><!----> <a href="/pages/e444e7/" class="nav-link">优秀博客文章</a></li><li class="dropdown-item"><!----> <a href="/pages/030cd4/" class="nav-link">其他</a></li></ul></div></div><div class="nav-item"><a href="/pages/55120e/" class="nav-link">收藏夹</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/weibw162/weibw162.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>微信公众号文章</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/b6414a/" class="sidebar-link">《50000字！数分面试必备数仓知识大全》</a></li><li><a href="/pages/0460ae/" aria-current="page" class="active sidebar-link">《面试笔记》——MySQL终结篇（30问与答）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/0460ae/#_01-三大范式" class="sidebar-link">01 三大范式？</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_02-innodb与myisam的区别" class="sidebar-link">02 InnoDB与MyISAM的区别？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/0460ae/#_2-1、myisam与innodb区别" class="sidebar-link">2.1、MyISAM与InnoDB区别</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_2-2、myisam" class="sidebar-link">2.2、MyISAM</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_2-3、innodb" class="sidebar-link">2.3、Innodb</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_2-4、使用场景" class="sidebar-link">2.4、使用场景</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_03-自增主键理解" class="sidebar-link">03 自增主键理解？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/0460ae/#自增主键" class="sidebar-link">自增主键：</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#自增值修改机制" class="sidebar-link">自增值修改机制：</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#自增值新增机制" class="sidebar-link">自增值新增机制：</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#为什么自增主键不连续" class="sidebar-link">为什么自增主键不连续</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_04-innodb为什么推介用自增id" class="sidebar-link">04 Innodb为什么推介用自增ID</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_05-什么是索引" class="sidebar-link">05 什么是索引</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_06-索引类型" class="sidebar-link">06 索引类型</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_07-索引底层数据结构" class="sidebar-link">07 索引底层数据结构？</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_08-b树与b-树区别-为何用b-树" class="sidebar-link">08 B树与B+树区别？为何用B+树？</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_09-索引设计原则-查询快-占用空间少" class="sidebar-link">09 索引设计原则（查询快，占用空间少）</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_10-索引失效场景" class="sidebar-link">10 索引失效场景？</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_11-如何创建索引" class="sidebar-link">11 如何创建索引</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_12-非聚簇索引一定会回表查询吗" class="sidebar-link">12 非聚簇索引一定会回表查询吗？</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_13-联合索引的建立规则" class="sidebar-link">13 联合索引的建立规则？</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_14-最左匹配原则" class="sidebar-link">14 最左匹配原则</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_15-前缀索引" class="sidebar-link">15 前缀索引</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_16-百万级数据如何删除" class="sidebar-link">16 百万级数据如何删除</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_17-普通索引和唯一索引怎样选" class="sidebar-link">17 普通索引和唯一索引怎样选</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/0460ae/#事务-隔离机制-日志-mvcc-锁" class="sidebar-link">事务&amp;隔离机制&amp;日志&amp;MVCC&amp;锁</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_18-一条sql查询语句执行过程" class="sidebar-link">18 一条sql查询语句执行过程</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_19-两阶段提交-一条更新语句怎么执行" class="sidebar-link">19 两阶段提交（一条更新语句怎么执行？）</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_20-mysql的事务原理" class="sidebar-link">20 mysql的事务原理</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_21-acid实现原理" class="sidebar-link">21 ACID实现原理</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_22-幻读问题详解" class="sidebar-link">22 幻读问题详解</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_23-mvcc原理" class="sidebar-link">23 MVCC原理</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_24-日志机制分析" class="sidebar-link">24 日志机制分析</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_25-explain分析" class="sidebar-link">25 Explain分析</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_26-脏页-怎样刷新脏页" class="sidebar-link">26 脏页？怎样刷新脏页？</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_27-mysql调优篇" class="sidebar-link">27 MYSQL调优篇</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/0460ae/#_27-1、一条sql执行很慢的原因" class="sidebar-link">27.1、一条sql执行很慢的原因？</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_27-2、sql优化-定位低效率sql-慢查询怎样处理" class="sidebar-link">27.2、sql优化（定位低效率sql，慢查询怎样处理）</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_28-主从同步" class="sidebar-link">28 主从同步</a></li><li class="sidebar-sub-header"><a href="/pages/0460ae/#_29-高可用架构" class="sidebar-link">29 高可用架构</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>优秀博客文章</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>其他</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-70a2d273><div class="articleInfo" data-v-70a2d273><ul class="breadcrumbs" data-v-70a2d273><li data-v-70a2d273><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-70a2d273></a></li> <li data-v-70a2d273><a href="/more" title="更多-目录页" data-v-70a2d273>更多</a></li> <li data-v-70a2d273><a href="/more/#微信公众号文章" title="更多#微信公众号文章" data-v-70a2d273>微信公众号文章</a></li> <!----></ul> <div class="info" data-v-70a2d273><div title="作者" class="author iconfont icon-touxiang" data-v-70a2d273><a href="https://github.com/weibw162" target="_blank" title="作者" class="beLink" data-v-70a2d273>weibw</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-70a2d273><a href="javascript:;" data-v-70a2d273>2022-01-20</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">
          《面试笔记》——MySQL终结篇（30问与答）
        </h1> <!----> <div class="theme-vdoing-content content__default"><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>本文章摘自微信公众号<code>小龙coding</code></p></div> <p>大家后，我是小龙。</p> <p>今天给大家带来我实习与秋招期间历经几十场面试总结下来的MySQL常考面试题，看看你能答对多少</p> <p>这是本期的MySQL面试题目录，不会的快快查漏补缺~</p> <p><img src="https://cdn.jsdelivr.net/gh/Weibw162/image-hosting@dev/%E5%85%AC%E4%BC%97%E5%8F%B7%E5%9B%BE%E7%89%87/image.1phvpkolftj4.webp" alt="image"></p> <h2 id="_01-三大范式"><a href="#_01-三大范式" class="header-anchor">#</a> 01 三大范式？</h2> <p>第一范式：字段具有<code>原子性</code>，不可再分（<strong>字段单一职责</strong>）</p> <p>第二范式：满足第一范式，每行应该被<code>唯一区分</code>，加一列存放每行的唯一标识符，称为主键（<strong>都要依赖主键</strong>）</p> <p>第三范式：满足一二范式，且一个表不能包含其他表已存在的非主键信息（不<strong>间接依赖</strong>-不存在其他表的非主键信息）</p> <div class="custom-block note"><p class="custom-block-title">范式优点与缺点</p> <p><strong>优点</strong>：范式化，重复冗余数据少，更新快，修改少，查询时更少的distinct</p> <p><strong>缺点</strong>：因为一个表不存在冗余重复数据，<strong>查询可能造成很多关联</strong>，效率变低，可能使一些<strong>索引策略无效</strong>，范式化将列存在不同表中，这些列若在同一个表中可以是一个索引。</p></div> <h2 id="_02-innodb与myisam的区别"><a href="#_02-innodb与myisam的区别" class="header-anchor">#</a> 02 InnoDB与MyISAM的区别？</h2> <h3 id="_2-1、myisam与innodb区别"><a href="#_2-1、myisam与innodb区别" class="header-anchor">#</a> <strong>2.1、MyISAM与InnoDB区别</strong></h3> <ul><li>InnoDB聚簇索引，MyISAM非聚簇索引</li> <li>InnoDB数据与索引一起保存.ibd，MyISAM表结构.frm 索引.myi 数据.myd</li> <li>InnoDB支持事务、外键、行锁表锁，MyISAM不支持事务、外键、只支持表锁</li> <li>select count(*)</li> <li>MyISAM查询更优，InnoDB更新更优</li> <li>都是B+tree索引</li> <li>MyISAM支持全文索引，InnoDB5.6后支持</li></ul> <h3 id="_2-2、myisam"><a href="#_2-2、myisam" class="header-anchor">#</a> <strong>2.2、MyISAM</strong></h3> <ul><li>不支持事务，但是每次查询都是原子的</li> <li>支持表级锁，每次操作对整个表加锁</li> <li>存储表的总行数</li> <li>一个MyISAM表有三个文件：表结构.frm 索引.myi 数据 .myd</li> <li>采用非聚集索引，索引文件的数据域存储指向数据文件的指针。辅索引与主索引基本一致，但是辅索引不用保证唯一性。</li></ul> <h3 id="_2-3、innodb"><a href="#_2-3、innodb" class="header-anchor">#</a> <strong>2.3、Innodb</strong></h3> <ul><li>支持ACID事务，支持四种隔离级别</li> <li>支持行级锁及外键约束，因此支持写并发</li> <li>不存储总行</li> <li>主键索引采用聚集索引(索引的数据域存储数据文件本身)，辅索引的数据域存储主键的值;因此从辅索引查找数据，需要先通过辅索引找到主键值，再访问辅索引；最好使用自增主键，防止插入数据时，为维持B+树结构，文件的大调整。</li></ul> <h3 id="_2-4、使用场景"><a href="#_2-4、使用场景" class="header-anchor">#</a> <strong>2.4、使用场景</strong></h3> <p>大多数时候我们使用的都是 InnoDB 存储引擎，在某些读密集的情况下，使用 MyISAM 也是合适的。不过，前提是你的项目不介意 MyISAM 不支持事务、崩溃恢复等缺点（可是~我们一般都会介意啊！）。</p> <ul><li><strong>MyISAM适合读多更新少的</strong>：MyISAM索引跟数据分开放，因此有读取更快的说法。</li> <li><strong>InnoDB适合插入更新频繁的</strong>：索引与数据一起放，建立索引更复杂，使用行锁，更新频繁效率更高</li> <li>需要事务，高并发场景用Innodb：Innodb支持事务，采用行锁</li> <li>MyISAM查询比InnoDB快，更新InnoDB快</li></ul> <p>场景：MyISAM查询更优，InnoDB更新更优</p> <p><strong>MyISAM适合读多，更新少的场景</strong>。MyISAM使用非聚簇索引，数据和索引分开存的，而InnoDB数据和索引存一起的，数据量大时，一个内存页大小固定，读进内存的数据MyISAM就多一点(数据量小看不出差距，数据量大时差距就明显）。</p> <p>因为MyISAM只把索引指针读进内存，可以存更多，查询速度也就更快，而且InnoDB还需要维护其他数据，比如其他隐藏字段 row_id、tx_id等</p> <h2 id="_03-自增主键理解"><a href="#_03-自增主键理解" class="header-anchor">#</a> 03 自增主键理解？</h2> <h3 id="自增主键"><a href="#自增主键" class="header-anchor">#</a> <strong>自增主键：</strong></h3> <p>InnoDB引擎的自增值，其实是<strong>保存在了内存</strong>里，并且到了MySQL 8.0版本后，才有了“自增值持久化”的能力。</p> <p>也就是才实现了“如果发生重启，表的自增值可以恢复为MySQL重启前的值”，具体情况是：（查看表结构，会看到自增主键=多少）</p> <ul><li>在MySQL 5.7及之前的版本，<strong>自增值保存在内存里</strong>，并没有持久化。每次重启后，第一次打开表的时候，都会去找<strong>自增值的最大值</strong>max(id)，然后将max(id)+1作为这个表当前的自增值。</li> <li><strong>举例来说</strong>：如果一个表当前数据行里最大的id是10，AUTO_INCREMENT=11。这时候，我们删除id=10的行，AUTO_INCREMENT还是11。但如果马上重启实例，重启后这个表的AUTO_INCREMENT就会变成10。也就是说，MySQL重启可能会修改一个表的AUTO_INCREMENT的值。</li> <li>在MySQL 8.0版本，将自增值的变更记录在了redo log中，重启的时候依靠redo log恢复重启之前的值。</li></ul> <h3 id="自增值修改机制"><a href="#自增值修改机制" class="header-anchor">#</a> <strong>自增值修改机制：</strong></h3> <ol><li>如果插入数据时id字段指定为0、null 或未指定值，那么就把这个表当前的 AUTO_INCREMENT值填到自增字段；</li> <li>如果插入数据时id字段指定了具体的值，就直接使用语句里指定的值。</li></ol> <h3 id="自增值新增机制"><a href="#自增值新增机制" class="header-anchor">#</a> <strong>自增值新增机制</strong>：</h3> <ol><li>如果准备插入的值&gt;=当前自增值，新的自增值就是“准备插入的值+1”；</li> <li>否则，自增值不变。</li></ol> <h3 id="为什么自增主键不连续"><a href="#为什么自增主键不连续" class="header-anchor">#</a> <strong>为什么自增主键不连续</strong></h3> <ul><li><p>在MySQL 5.7及之前的版本，自增值保存在内存里，并没有持久化</p></li> <li><p>事务<strong>回滚</strong>（自增值不能回退，因为并发插入数据时，回退自增ID可能造成主键冲突）</p></li> <li><p>唯一键冲突（由于表的自增值已变，但是主键发生冲突没插进去，下一次插入主键=现在变了的子增值+1，所以不连续）</p></li></ul> <p><strong>eg：</strong></p> <p>假设，表t里面已经有了(1,1,1)这条记录，这时我再执行一条插入数据命令：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span>自增id<span class="token punctuation">,</span>唯一键c<span class="token punctuation">,</span>普通字段d<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这个语句的执行流程就是：</p> <ol><li><p>执行器调用InnoDB引擎接口写入一行，传入的这一行的值是(0,1,1);</p></li> <li><p>InnoDB发现用户没有指定自增id的值，获取表t当前的自增值2；s</p></li> <li><p>将传入的行的值改成(2,1,1)；</p></li> <li><p>将表的自增值改成3；</p></li> <li><p>继续执行插入数据操作，由于已经存在c=1的记录，所以报Duplicate key error，语句返回。</p></li></ol> <p>这个表的自增值改成3，是在真正执行插入数据的操作之前。这个语句真正执行的时候，因为碰到唯一键c冲突，所以id=2这一行并没有插入成功，但也没有将自增值再改回去。</p> <p>所以，在这之后，再插入新的数据行时，拿到的自增id就是3。也就是说，出现了自增主键不连续的情况。</p> <h2 id="_04-innodb为什么推介用自增id"><a href="#_04-innodb为什么推介用自增id" class="header-anchor">#</a> 04 Innodb为什么推介用自增ID</h2> <p>①主键页就会近乎于顺序的记录填满，提升了页面的最大填充率，不会有页的浪费。</p> <p>②新插入的行一定会在原有的最大数据行下一行，mysql定位和寻址很快，不会为计算新行的位置而做出额外的消耗。</p> <p>③减少了页分裂和碎片的产生</p> <p>UUID：<strong>大量的随机IO</strong>+<strong>页分裂导致移动大量的数据</strong>+数据会有碎片。</p> <div class="custom-block tip"><p class="custom-block-title">总结</p> <p>自增ID有序，会按顺序往最后插入，而UUID无序，随机生成，随机插入，会造成频繁页分裂，内存碎片化，大量随机IO</p></div> <h2 id="_05-什么是索引"><a href="#_05-什么是索引" class="header-anchor">#</a> 05 什么是索引</h2> <ul><li><p>排好序的数据结构，可以帮助快速查找数据</p></li> <li><p>优缺点：索引可以提高查询速度，查询使用优化隐藏器提高性能，但是也会占据物理空间，降低增删改的速度，因为还要操作索引文件</p></li></ul> <h2 id="_06-索引类型"><a href="#_06-索引类型" class="header-anchor">#</a> 06 索引类型</h2> <p>覆盖索引+回表+索引下推+联合索引</p> <ul><li><p>普通索引：可以重复</p></li> <li><p>唯一索引：唯一，可为空，表中只有一个主键索引，可多个唯一索引</p></li> <li><p>主键索引</p></li> <li><ul><li>唯一，不为空，叶子结点存出了行记录数据，主键索引也称聚簇索引，对应非主键索引的叶子结点存的主键的值（二级索引），用二级索引查需要回表操作（根据二级索引查到主键，再根据主键去主键索引查）</li> <li>一般推荐用自增主键，<strong>保证空间利用率，减少页分裂</strong></li></ul></li> <li><p>全文索引</p></li> <li><p>覆盖索引：索引字段覆盖了查询语句涉及的字段，直接通过索引文件就可以返回查询所需的数据，不必通过回表操作。</p></li> <li><p>回表：通过索引找到主键，再根据主键id去主键索引查。</p></li> <li><p>索引下推</p></li> <li><ul><li>在根据索引查询过程中就根据查询条件过滤掉一些记录，减少最后的回表操作</li></ul></li></ul> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>假如执行select * from stu where name=? and age=?</p> <p>没有索引下推先再存储引擎根据name筛选数据返回给server层，然后server层再根据age过滤</p> <p>有索引下推直接根据name和age在存储引擎层就筛选得到结果</p></div> <h2 id="_07-索引底层数据结构"><a href="#_07-索引底层数据结构" class="header-anchor">#</a> 07 索引底层数据结构？</h2> <p><strong>B+树、hash</strong></p> <p>hash底层是哈希表实现，等值查询，可以快速定位，一般情况效率很高，不稳定，当出现大量键重复哈希冲突，效率下降，不支持范围查询，无法用于排序分组，无法模糊查询，多列索引的最左前缀匹配原则，总要回表操作等。</p> <h2 id="_08-b树与b-树区别-为何用b-树"><a href="#_08-b树与b-树区别-为何用b-树" class="header-anchor">#</a> 08 B树与B+树区别？为何用B+树？</h2> <p>B+树：非叶子结点不存data，只存key，查询更稳定，增大了广度(B+树出度更大，树高矮，节点小，磁盘IO次数少)；叶子结点下一级指针（范围查询）；索引冗余。</p> <p>与红黑树相比：</p> <p><strong>更少查询次数</strong>：B+树出度更大，树高更低，查询次数更少</p> <p><strong>磁盘预读原理</strong>：为了减少IO操作，往往不严格按需读取，而是预读。B+树叶子<strong>结点存储相临</strong>，<strong>读取会快一些</strong>。</p> <p>**存储更多索引结点：**B+树只在叶子结点储存数据，非叶子结点存索引，而一个结点就是磁盘一个内存页，内存页大小固定，那么相比B树这些可以·存更多的索引结点，出度更大，树高矮，查询次数少，磁盘IO少。</p> <h2 id="_09-索引设计原则-查询快-占用空间少"><a href="#_09-索引设计原则-查询快-占用空间少" class="header-anchor">#</a> 09 索引设计原则（查询快，占用空间少）</h2> <ul><li><p>出现在where子句或则连接子句中的列</p></li> <li><p>基数小的表没必要</p></li> <li><p>使用短索引，如果索引长字符串列，应该指定前缀长度</p></li> <li><p>定义有外键的数据列一定索引</p></li> <li><p>不要过度索引</p></li> <li><p>更新频繁的不适合</p></li> <li><p>区分度不高的不适合，如性别</p></li> <li><p>尽量扩展索引，别新建索引，如(a)-&gt;(a,b)</p></li> <li><p>字符串字段建立索引方法</p></li> <li><ul><li>1、直接创建完整索引，这样可能比较占用空间；</li> <li>2、创建前缀索引，节省空间，但会增加查询扫描次数，并且不能使用覆盖索引；</li> <li>3、倒序存储，再创建前缀索引，用于绕过字符串本身前缀的区分度不够的问题；</li> <li>4、额外用一个字段进行索引，额外计算开销</li></ul></li></ul> <div class="custom-block tip"><p class="custom-block-title">总结</p> <p>索引设计原则要求查询快，占用空间少；一般建在where条件，匹配度高的；要求基数大，区分度高，不要过大索引，尽量扩展，用联合索引，更新频繁不适合、使用短索引。</p></div> <h2 id="_10-索引失效场景"><a href="#_10-索引失效场景" class="header-anchor">#</a> 10 索引失效场景？</h2> <ul><li>以“%”开头的like语句，索引无效，后缀“%”不影响</li> <li>or语句前后没有同时使用索引</li> <li>列类型是字符串，一定要在条件中将数据用引号引用，否则失效（隐式转换）</li> <li>如果mysql估计使用全表扫描比索引快，则不用索引（键值少，重复数据多）</li> <li>组合索引要遵守最左前缀原则——不使用第一列索引 失效</li> <li>在索引字段上使用not，&lt;&gt;，！= （对它处理是全表扫描）</li> <li>对索引字段进行计算操作，字段使用函数也会失效</li> <li>is null</li></ul> <h2 id="_11-如何创建索引"><a href="#_11-如何创建索引" class="header-anchor">#</a> 11 如何创建索引</h2> <ul><li>ALTER TABLE table_name ADD INDEX index_name (column_list)；</li> <li>CREATE INDEX index_name ON table_name (column_list)；</li> <li>在create table时创建</li></ul> <h2 id="_12-非聚簇索引一定会回表查询吗"><a href="#_12-非聚簇索引一定会回表查询吗" class="header-anchor">#</a> 12 非聚簇索引一定会回表查询吗？</h2> <p>查询字段全部命中索引，覆盖索引，不走回表，直接从索引得到结果，不要查数据文件</p> <p><strong>总结：覆盖索引就不走回表</strong></p> <h2 id="_13-联合索引的建立规则"><a href="#_13-联合索引的建立规则" class="header-anchor">#</a> 13 联合索引的建立规则？</h2> <ul><li><p>将<strong>查询需求频繁</strong>或者<strong>字段选择性高</strong>的列放在前面</p></li> <li><p>索引的<strong>复用</strong>，可以少维护一些索引(a)-&gt;(a,b)</p></li> <li><ul><li>如果既有联合查询，又有基于a、b各自的查询呢？：考虑的原则就是空间，将小的单独建索引</li></ul></li></ul> <h2 id="_14-最左匹配原则"><a href="#_14-最左匹配原则" class="header-anchor">#</a> 14 最左匹配原则</h2> <p>从左往右匹配，直到遇到范围查询</p> <p>建立联合索引（a,b,c）</p> <p>索引是先根据a排序，a相同时b有序，a不同无序，以此类推。总之遇到范围查询就停。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>  （a<span class="token punctuation">,</span>b）联合索引 <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
                    \<span class="token operator">|</span><span class="token operator">/</span>    \<span class="token operator">|</span><span class="token operator">/</span>
   <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>     <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
规律：a有顺序（<span class="token number">1</span>，<span class="token number">1</span>，<span class="token number">2</span>，<span class="token number">2</span>，<span class="token number">2</span>，<span class="token number">3</span>，<span class="token number">3</span>）b无顺序，a相同时b又有顺序，不同a之间b没有顺序，所以a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>b<span class="token operator">&gt;</span><span class="token number">2</span>走联合索引；a<span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">,</span>b<span class="token operator">&gt;</span><span class="token number">2</span>不走索引。

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table_name <span class="token keyword">where</span> a <span class="token operator">=</span> <span class="token string">'1'</span> <span class="token operator">and</span> b <span class="token operator">=</span> <span class="token string">'2'</span> <span class="token operator">and</span> c <span class="token operator">=</span> <span class="token string">'3'</span>
<span class="token comment">//全值匹配查询，用到索引，与顺序无关，查询优化器，会自动优化查询顺序 </span>

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table_name <span class="token keyword">where</span> a <span class="token operator">=</span> <span class="token string">'1'</span> 
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table_name <span class="token keyword">where</span> a <span class="token operator">=</span> <span class="token string">'1'</span> <span class="token operator">and</span> b <span class="token operator">=</span> <span class="token string">'2'</span>  
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table_name <span class="token keyword">where</span> a <span class="token operator">=</span> <span class="token string">'1'</span> <span class="token operator">and</span> b <span class="token operator">=</span> <span class="token string">'2'</span> <span class="token operator">and</span> c <span class="token operator">=</span> <span class="token string">'3'</span>
<span class="token comment">//匹配左边的列时，用到了索引</span>

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table_name <span class="token keyword">where</span>  b <span class="token operator">=</span> <span class="token string">'2'</span> 
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table_name <span class="token keyword">where</span>  c <span class="token operator">=</span> <span class="token string">'3'</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table_name <span class="token keyword">where</span>  b <span class="token operator">=</span> <span class="token string">'1'</span> <span class="token operator">and</span> c <span class="token operator">=</span> <span class="token string">'3'</span>
<span class="token comment">//没有用到索引</span>

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table_name <span class="token keyword">where</span> a <span class="token operator">=</span> <span class="token string">'1'</span> <span class="token operator">and</span> c <span class="token operator">=</span> <span class="token string">'3'</span> 
<span class="token comment">//a用到了索引，b、c没有到</span>

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table_name <span class="token keyword">where</span>  a <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">and</span> a <span class="token operator">&lt;</span> <span class="token number">3</span> <span class="token operator">and</span> b <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">//只有a用到索引，在1&lt;a&lt;3的范围内b是无序的，不能用索引，找到1&lt;a&lt;3的记录后，只能根据条件 b &gt; 1继续逐条过滤</span>

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table_name <span class="token keyword">where</span>  a <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">and</span> b <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token comment">// a=1的情况下b是有序的，进行范围查找走的是联合索引 走 a b索引(a相同时b有序)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="_15-前缀索引"><a href="#_15-前缀索引" class="header-anchor">#</a> 15 前缀索引</h2> <p>尽量创建短索引，对长子字符串创索引可使用前缀索引，使用字段值前几个字符作为索引 index(filed(10))</p> <h2 id="_16-百万级数据如何删除"><a href="#_16-百万级数据如何删除" class="header-anchor">#</a> 16 百万级数据如何删除</h2> <p>删除数据的速度和创建的索引数量是成正比的。先删索引，再删无用数据，再创建索引</p> <h2 id="_17-普通索引和唯一索引怎样选"><a href="#_17-普通索引和唯一索引怎样选" class="header-anchor">#</a> 17 普通索引和唯一索引怎样选</h2> <ul><li><p>查询比较</p></li> <li><ul><li>查询会以页为单位将数据页加载进内存，不需要一条记录一条记录读取磁盘。然后唯一索引根据条件查询到记录时就返回结果，普通索引查到第一条记录往后遍历直到不满足条件，由于都在内存中，不需要磁盘读取那么大开销，带来的额外查询开销忽略不计，所以查询性能几乎一致</li></ul></li> <li><p>更新比较</p></li> <li><ul><li>唯一索引由于更新时<strong>要检查唯一性</strong>，所以需要将数据页先加载进内存才能判断，此时直接操作内存，不需要操作change buffer</li> <li>补充：普通索引若数据再内存中直接内存中更新，否则会将更新操作先记录到channge buffer中，等下一次查询将数据读到内存中再进行change buffer里相关更新操作后将数据返回，这样一来，再<strong>写多读少的情况下就减少了磁盘IO</strong>，若写完就马上查询，就大可不必用change buffer，不但没提高多少效率还造成维护change buffer额外消耗</li> <li>将change buffer的操作对应到原始数据页的操作称为merge（可以查询来时读到内存再修改数据，后台线程也会merge，数据库正常关闭也会merge）</li></ul></li> <li><p>适合场景</p></li> <li><ul><li>写多读少，选用普通索引更好，可以利用<strong>change buffer</strong>进行性能优化减少磁盘IO，将更新操作记录到change bufer，等查询来了将数据读到内存再进行修改.</li></ul></li></ul> <h3 id="事务-隔离机制-日志-mvcc-锁"><a href="#事务-隔离机制-日志-mvcc-锁" class="header-anchor">#</a> <strong>事务&amp;隔离机制&amp;日志&amp;MVCC&amp;锁</strong></h3> <h2 id="_18-一条sql查询语句执行过程"><a href="#_18-一条sql查询语句执行过程" class="header-anchor">#</a> 18 一条sql查询语句执行过程</h2> <p><strong>mysql分为server层与存储引擎层，server层包含连接器、分析器、优化器、执行器</strong>**。**</p> <p>接下来以一条sql查询语句执行过程介绍各个部分功能。客户端执行一条sql：</p> <p>1、首先由连接器进行<strong>身份验证，权限管理</strong></p> <p>2、若开启了缓存，会<strong>检查缓存</strong>是否有该sql对应结果（缓存存储形式key-vlaue，key是执行的sql，value是对应的值）若开启缓存又有该sql的映射，将结果直接返回；</p> <p>3、分析器进行<strong>词法语法分析</strong></p> <p>4、优化器会<strong>生成执行计划</strong>、选择索引等操作，选取最优执行方案</p> <p>5、然后来到执行器，打开表调用存储引擎接口，逐行判断是否满足查询条件，满足放到结果集，最终返回给客户端；若用到索引，筛选行也会根据索引筛选。</p> <p><img src="https://cdn.jsdelivr.net/gh/Weibw162/image-hosting@dev/%E5%85%AC%E4%BC%97%E5%8F%B7%E5%9B%BE%E7%89%87/image.1wpmn1drdksg.webp" alt="image"></p> <h2 id="_19-两阶段提交-一条更新语句怎么执行"><a href="#_19-两阶段提交-一条更新语句怎么执行" class="header-anchor">#</a> 19 两阶段提交（一条更新语句怎么执行？）</h2> <p>1、<strong>引擎</strong>先根据筛选条件<strong>筛选</strong>对应的行返回<strong>给执行器</strong>（若对应的行在内存直接返回，否则先去磁盘读取再返回）</p> <p>2、<strong>执行器执行相关更新操作</strong>然后调用<strong>引擎接口写回</strong>更新后数据</p> <p>3、引擎将新数据更新到内存，将更新操作记录到redolog，redolog处于prepare，告知执行器执行完，可提交事务</p> <p>4、执行器生成该操作的binlog 并将binlog写入磁盘</p> <p>5、执行器调用引擎事务提交接口，引擎把刚写入的redolog改为commit状态，更新完成。</p> <h2 id="_20-mysql的事务原理"><a href="#_20-mysql的事务原理" class="header-anchor">#</a> 20 mysql的事务原理</h2> <p>事务：一系列操作组成，要么全部成功，要么全部失败</p> <div class="custom-block tip"><p class="custom-block-title">事务ACID特性</p> <ol><li>原子性：一些列操作要么全部成功，要么全部失败</li> <li>隔离性：事务的结果只有提交了其他事务才可见</li> <li>一致性：数据库总时从一个一致状态变到另一个一致状态（事务修改前后的<strong>数据总体保证一致 转账</strong>）</li> <li>持久性：事务提交后，对数据修改永久的</li></ol></div> <p><strong>事务的并发问题</strong>：</p> <ol><li>脏读：读到未提交的数据</li> <li>不可重复读：一个事务下，两次读取数据不一致（侧重内容数据的修改）</li> <li>幻读：事务A 按照一定条件进行数据读取， 期间事务B 插入了相同搜索条件的新数据，事务A再次按照原先条件进行读取时，发现了事务B 新插入的数据 称为幻读（侧重新增或删除，插入数据读到多了一行）</li></ol> <p><strong>隔离级别原理及解决问题分析</strong>：</p> <ol><li><p>读未提交：原理：直接读取数据，不能解决任何并发问题</p></li> <li><p>读已提交：读操作不加锁，写操作加排他锁，解决了脏读。原理：利用MVCC实现，每一句语句执行前都会生成Read View（一致性视图）</p></li> <li><p>可重复读：MVCC实现，只有事务开始时会创建Read View，之后事务里的其他查询都用这个Read View。解决了脏读、不可重复读，快照读（普通查询，读取历史数据）使用MVCC解决了幻读，当前读（读取最新提交数据）通过间隙锁解决幻读（lock in share mode、for update、update、detete、insert），间隙锁在可重复读下才生效。（<strong>默认隔离级别</strong>）</p></li> <li><p>可串行化：原理：使用锁，读加共享锁，写加排他锁，串行执行</p></li></ol> <div class="custom-block tip"><p class="custom-block-title">总结</p> <p>读已提交和可重复读实现原理就是MVCC Read View不同的生成时机。可重复读只在事务开始时生成一个Read View，之后都用的这个；读已提交每次执行前都会生成Read View。</p></div> <h2 id="_21-acid实现原理"><a href="#_21-acid实现原理" class="header-anchor">#</a> 21 ACID实现原理</h2> <p>原子性：undolog（记录事务开始前的老版本数据，可以保证原子操作，回滚，实现MVCC版本链）</p> <p>隔离性：MVCC</p> <p>持久性：redo log（记录事务开启后对数据的修改，可用于crash-safe）</p> <h2 id="_22-幻读问题详解"><a href="#_22-幻读问题详解" class="header-anchor">#</a> 22 幻读问题详解</h2> <p><strong>幻读问题详解：</strong></p> <p>1、创建tx实验表</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>tx<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>tx<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>
<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Records of tx</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>tx<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'20'</span><span class="token punctuation">,</span> <span class="token string">'张三'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>tx<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'20'</span><span class="token punctuation">,</span> <span class="token string">'李四'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>2、实验</p> <p><img src="https://cdn.jsdelivr.net/gh/Weibw162/image-hosting@dev/%E5%85%AC%E4%BC%97%E5%8F%B7%E5%9B%BE%E7%89%87/image.6tkluegbnhs0.webp" alt="image"></p> <p>结论（仔细理解，讲收获满满，本人认真总结的）：</p> <p>1、发现RR隔离界别<strong>若只快照读与当前读没有幻读问题</strong>，快照读（普通查询，如select * from table）读取旧的历史版本，用MVCC实现（MVCC原理下文分析），会在事务开始时生成一个Read View，之后都用这个Read View实现RR隔离级别。</p> <p>当前读（select ... for update ，select ... lock in share mode ，update/insert/delete语句）读取最新数据版本，依靠间隙锁或则临键锁解决幻读，当你事务T1执行当前读，然后事务T2插入语句，事务T2会被阻塞住，插不进去。</p> <p>2、当你事务T1中<strong>先执行快照读，事务T2插入数据并提交，事务T1再执行当前读（比如以相同条件更新数据），会发现出现幻读</strong>，更新到了新插入行的数据。</p> <p>白话文解释：事务1先以某个条件比如age=20的查询得到2条数据，然后事务2插入新的数据age也为20然后提交事务，此时事务1更新age=20的数据，发现更新到了3行，把事务T2新插入的那行也更新了。</p> <p>所以<strong>幻读注重你插入新数据都修改改到了新插入的数据，而不可重复读是你修改了某个数据，两次查询得到不一致结果。</strong></p> <div class="custom-block tip"><p class="custom-block-title">总结</p> <p><strong>RR隔离界别并没有完全解决幻读</strong>只使用快照都或则当前读不会幻读。若先快照读，然后当前读，期间按快照读相同条件插入数据，当前读就会发生幻读。</p></div> <h2 id="_23-mvcc原理"><a href="#_23-mvcc原理" class="header-anchor">#</a> 23 MVCC原理</h2> <p>多版本并发控制。</p> <p>原理提炼总结：使用版本链+Read View</p> <p>详解：</p> <p><strong>版本链</strong> 同一行数据可能有多个版本</p> <p>innodb数据表每行数据记录会有几个隐藏字段，row_id，事务ID，回滚指针。</p> <p>1、Innodb采用主键索引（聚簇索引），会利用主键维护索引，若表没有主键，就用第一个非空唯一索引，若没有唯一索引，则用row_id这个隐藏字段作为主键索引。</p> <p>2、事务开启会向系统申请一个事务ID，严格递增，会向行记录插入最近操作它的那个事务的ID。</p> <p>3、undolog会记录事务前老版本数据，然后行记录中回滚指针会指向老版本位置，如此形成一条版本链。因此可以利用undo log实现回滚，保证原子性，同时用于实现MVCC版本链。</p> <p><img src="https://cdn.jsdelivr.net/gh/Weibw162/image-hosting@dev/%E5%85%AC%E4%BC%97%E5%8F%B7%E5%9B%BE%E7%89%87/image.6nl9kr5ie980.webp" alt="image"></p> <p><strong>Read View</strong>读已提交隔离级别下，会在每次查询都生成一个Read View，可重读读只在事务开始时生成一个Read View，以后每次查询都用这个Read View，以此实现不同隔离界别。</p> <p><strong>Read View里面包含些什么？（一致性视图）</strong></p> <p><strong>一个数组+p_limit_id(低水位)+low_limit_id(高水位)</strong>（这里的up,low没写错，就是这么定义的）</p> <p>数组里包含<strong>事务启动时</strong>当前活跃事务ID(未提交事务)，低水位就是活跃事务最小ID，高水位就是下一次将分配的事务ID，也就是目前最大事务ID+1。</p> <p><strong>数据可见性规则是怎样实现的？</strong></p> <p>数据版本的可见性规则，就是<strong>基于数据的row、trx_id</strong>和这个**一致性视图（Read View）**的对比结果得到的。</p> <p>视图数组把所有的row trx_id 分成了几种不同的情况</p> <p><img src="https://cdn.jsdelivr.net/gh/Weibw162/image-hosting@dev/%E5%85%AC%E4%BC%97%E5%8F%B7%E5%9B%BE%E7%89%87/image.7icvybqoods0.webp" alt="image"></p> <p><strong>读取原理：</strong></p> <p>某事务T要访问数据A，先获取该数据A中的事务id(获取最近操作它的事务的事务ID)，对比该事务T启动时刻生成的</p> <p><strong>Read View:</strong></p> <p>1、如果在readview的左边(比readview都小)，表示这个事务可以访问这数据（在左边意味着该事务已经提交)</p> <p>2、如在readview的右边(比readview都大），表示这个版本是由将来启动的事务生成的，是肯定不可见的；</p> <p>3、如果当前事务在未提交事务集合中：</p> <p>a、若 row trx_id在数组中，表示这个版本是由还没提交的事务生成的，不可见；</p> <p>b. 若 row trx_id不在数组中，表示这个版本是已经提交了的事务生成的，可见。</p> <p>不可以访问，获取roll_pointer，通过版本链取上一版本</p> <p>根据数据历史版本事务ID再重新与视图数组对比。</p> <p>这样执行下来，虽然期间这一行数据被修改过，但是事务A不论在什么时候查询，看到这行数据的结果都是一致的，所以我们称之为一致性读。</p> <h2 id="_24-日志机制分析"><a href="#_24-日志机制分析" class="header-anchor">#</a> 24 日志机制分析</h2> <p>前置知识，为了保证事务ACID中的一致性与原子性，mysql采用WAL，预写日志，先写日志，合适时再写磁盘。</p> <p>innodb引擎级别有undo log与redo log，mysql server级别有bin log。</p> <p><strong>undo log</strong></p> <p>回滚日志</p> <p>**作用：**undolog记录事务开始前老版本数据，用于实现回滚，保证原子性，实现MVCC，会将数据修改前的旧版本保存在undolog，然后行记录有个隐藏字段回滚指针指向老版本。</p> <p><strong>redo log</strong></p> <p>物理日志</p> <p><strong>作用</strong>：会记录事务开启后对数据做的修改，crash-safe</p> <p><strong>特性</strong>：<strong>空间一定，写完后会循环写</strong>，有两个指针write pos指向当前记录位置，checkpoint指向将擦除的位置，redolog相当于是个取货小车，货物太多时来不及一件一件入库太慢了这样。</p> <p>就先将货物放入小车，等到货物不多或则小车满了或则店里空闲时再将小车货物送到库房。<strong>用于crash-safe</strong>，数据库异常断电等情况可用redo log恢复。</p> <p><strong>写入流程</strong>：先写redo log buffer，然后wite到文件系统的page cache，此时并没有持久化，然后fsync持久化到磁盘。</p> <p>**写入策略：**根据innodb_flush_log_at_trx_commit参数控制（我的记忆：innodb以事务的什么提交方式刷新日志）</p> <p>0——&gt;事务提交时只把redo log留在redo log buffer</p> <p>1——&gt;将redo log直接持久化到磁盘（所以有个双“1”配置，后面会讲）</p> <p>2——&gt;只是把redo log写到page cache</p> <p><strong>bin log</strong></p> <p>用于主备同步</p> <p><strong>有3种格式：</strong></p> <p>row：记录整行数据，更新记录更新前后的数据</p> <p>缺点：记录每行数据，占空间</p> <p>statement：记录整条sql语句</p> <p>缺点：可能造成主从不一致</p> <p>mysql&gt; delete from t where a&gt;=4 and b&lt;=5 limit 1;</p> <p>主库是索引a,那么删除a=4</p> <p>备库是索引b,那么删除b=5</p> <p>mixed：会判断statement格式下sql语句是否会造成主备不一致，不造成就statement格式，否则就row格式。</p> <p><strong>写入机制</strong>：</p> <p>1、事务执行过程中将日志记录到binlog cache（系统为binlog分配了一块内存，每个线程一份）</p> <p>2、事务提交时，执行器把binlog cache里的完整事务写入到binlog中，并清空binlog cache</p> <ul><li>write：把日志写到文件系统的page cache，没有写磁盘，速度快</li> <li>fsync：将数据持久化到磁盘的操作，这时才占磁盘IOPS</li></ul> <p>根据sync_binlog参数控制：</p> <p>0——&gt;只write，不fsync</p> <p>1——&gt;每次fsyncN</p> <p>&gt;1——&gt;每次事务都write，等累积到N后才fsync。</p> <p>可以将sync_binlog设置大一点提高性能（可以提高IO性能，但是若发生异常，日志会丢失）</p> <p>这里sync_binlog和innodb_flush_log_at_trx_commit配合设置双1模式</p> <p><strong>两阶段提交</strong></p> <p>想要全面了解两阶段提交，我接下从这3个方面分析：</p> <p>1、何为两阶段提交？</p> <p>2、为什么要两阶段提交？</p> <p>3、两阶段提交的过程是怎样的？</p> <p>**何为两阶段提交？（2PC）**mysql中在server层级别有个binlog日志，归档日志，用于备份，主从同步复制，如果采用一主多从架构，主备切换，那就必须用到binlog进行主从同步。</p> <p>此时事务提交就必须保证redolog与binlog的一致性，一般情况没有开启binlog日志，事务提交不会两阶段提交，若需要主从同步就必须开启binlog使用两阶段提交保证数据一致性。</p> <p>**为什么要两阶段提交？**保证redolog与binlog一致性，保证事务在多个引擎的原子性。</p> <p><strong>两阶段提交过程？</strong></p> <p><strong>Prepare 阶段</strong>：InnoDB 将回滚段undolog设置为 prepare 状态；将 redolog 写文件并刷盘；</p> <p>（1、先写redolog，事务进入prepare状态）</p> <p><strong>Commit 阶段</strong>：Binlog 写入文件；binlog 刷盘；InnoDB commit；</p> <p>（2、prepare成功，binlog写盘，然后事务进入commit状态，同时会在redolog记录commite标识，代表事务提交成功）</p> <p><strong>redolog与binlog怎样联系起来的？</strong>（XID）</p> <ul><li>崩溃恢复的时候，会按顺序扫描redo log，若redolog既有prepare又有commit，直接提交</li> <li>如果碰到只有prepare、而没有commit的redo log，就拿着XID去binlog找对应的事务。</li></ul> <p><strong>怎样判断binlog是否完整？</strong></p> <ul><li>statement格式的binlog，最后会有COMMIT</li> <li>row格式 末尾有XID event</li></ul> <p><strong>2pc不同时刻的崩溃恢复？</strong></p> <ul><li>1、redolog有commite标识，事务完整，直接提交事务</li> <li>2、若redolog里面的事务只有完整的prepare，则判断对应事务的binlog是否存在并完整 （是-提交事务 | 否-回滚事务）</li></ul> <h2 id="_25-explain分析"><a href="#_25-explain分析" class="header-anchor">#</a> 25 Explain分析</h2> <p>type：表示MySQL在表中找到所需行的方式，或者叫访问类型</p> <ul><li><p><strong>type=ALL，全表扫描，MySQL遍历全表来找到匹配行</strong></p></li> <li><p><strong>type=index，索引全扫描</strong></p></li> <li><p><strong>type=range，索引范围扫描</strong></p></li> <li><p><strong>type=eq_ref，唯一索引</strong></p></li> <li><p><strong>type=NULL，MySQL不用访问表或者索引，直接就能够得到结果（性能最好）</strong></p></li></ul> <p><strong>possible_keys</strong>: 表示查询可能使用的索引</p> <p><strong>key</strong>: 实际使用的索引</p> <p><strong>key_len</strong>: 使用索引字段的长度</p> <p><strong>rows</strong>: 扫描行的数量</p> <p><strong>Extra</strong>：</p> <ul><li>using index：覆盖索引，不回表</li> <li>using where：回表查询</li> <li>using filesort：需要额外的排序，不能通过索引得到排序结果</li></ul> <h2 id="_26-脏页-怎样刷新脏页"><a href="#_26-脏页-怎样刷新脏页" class="header-anchor">#</a> 26 脏页？怎样刷新脏页？</h2> <p>内存数据页和磁盘数据页不一致。</p> <p><strong>刷脏页情景：</strong></p> <p><strong>redo log写满了</strong>，停止所有更新操作，将checkpoint向前推进，推进那部分日志的脏页更新到磁盘。</p> <p><strong>系统内存不够</strong>，需要将一部分数据页淘汰，如果是干净页，直接淘汰就行了，脏页的话，需要全部同步到磁盘。</p> <p>mysql自认为<strong>空闲</strong>时</p> <p>mysql<strong>正常关闭</strong>之前</p> <h2 id="_27-mysql调优篇"><a href="#_27-mysql调优篇" class="header-anchor">#</a> 27 MYSQL调优篇</h2> <h3 id="_27-1、一条sql执行很慢的原因"><a href="#_27-1、一条sql执行很慢的原因" class="header-anchor">#</a> <strong>27.1、一条sql执行很慢的原因？</strong></h3> <p>一个 SQL 执行的很慢，我们要分两种情况讨论：</p> <h5 id="_1、大多数情况下很正常-偶尔很慢-则有如下原因"><a href="#_1、大多数情况下很正常-偶尔很慢-则有如下原因" class="header-anchor">#</a> <strong>1、大多数情况下很正常，偶尔很慢，则有如下原因</strong></h5> <p>(1)、数据库在<strong>刷新脏页</strong>，例如 redo log 写满了需要同步到磁盘。</p> <p>(2)、执行的时候，<strong>遇到锁</strong>，如表锁、行锁。</p> <p>(3)、<strong>sql写的烂</strong>了</p> <h5 id="_2、这条-sql-语句一直执行的很慢-则有如下原因"><a href="#_2、这条-sql-语句一直执行的很慢-则有如下原因" class="header-anchor">#</a> <strong>2、这条 SQL 语句一直执行的很慢，则有如下原因</strong></h5> <p>(1)、没有用上索引或则索引失效：例如该字段没有索引；由于对字段进行运算、函数操作导致无法用索引。</p> <p>(2)、有索引可能会走全表扫描</p> <p>怎样判断是否走全表扫描：</p> <p>索引区分度（索引的值不同越多，区分度越高），称为基数，而数据量大时不可能全部扫描一遍得到基数，而是采样部分数据进行预测，那有可能预测错了，导致走全表扫描。</p> <h3 id="_27-2、sql优化-定位低效率sql-慢查询怎样处理"><a href="#_27-2、sql优化-定位低效率sql-慢查询怎样处理" class="header-anchor">#</a> <strong>27.2、sql优化（定位低效率sql，慢查询怎样处理）</strong></h3> <h5 id="_1-数据库中设置sql慢查询"><a href="#_1-数据库中设置sql慢查询" class="header-anchor">#</a> （1）数据库中设置SQL慢查询</h5> <p>方式一：修改配置文件 在 my.ini 增加几行: 主要是慢查询的定义时间（超过2秒就是慢查询），以及慢查询log日志记录（ slow_query_log）</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token punctuation">[</span>mysqlld<span class="token punctuation">]</span>
<span class="token comment">//定义查过多少秒的查询算是慢查询，我这里定义的是2秒</span>
long_query_time<span class="token operator">=</span><span class="token number">2</span>
<span class="token comment">#5.8、5.1等版本配置如下选项</span>
log<span class="token operator">-</span>slow<span class="token operator">-</span>queries<span class="token operator">=</span><span class="token string">&quot;mysql_slow_query.log&quot;</span>
<span class="token comment">#5.5及以上版本配置如下选项</span>
slow<span class="token operator">-</span>query<span class="token operator">-</span>log<span class="token operator">=</span><span class="token keyword">On</span>
slow_query_log_file<span class="token operator">=</span><span class="token string">&quot;mysql_slow_query. log&quot;</span>
<span class="token number">1</span><span class="token operator">/</span>记录下没有使用索引的query
log<span class="token operator">-</span>query<span class="token operator">-</span><span class="token operator">not</span><span class="token operator">-</span><span class="token keyword">using</span><span class="token operator">-</span>indexestpspb16glos dndnorte<span class="token operator">/</span>t
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>方式二：通过MySQL数据库开启慢查询:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>mysql&gt;set global slow_query_log=ON
mysql&gt;set global long_query_time = 3600;
mysql&gt;set global log_querise_not_using_indexes=ON;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="_2-分析慢查询日志"><a href="#_2-分析慢查询日志" class="header-anchor">#</a> （2）分析慢查询日志</h5> <p>可以通过以下命令定位低效率执行sql
<strong>show processlist</strong>sql 可以用 <strong>explain</strong> 分析执行计划</p> <h5 id="_3-优化"><a href="#_3-优化" class="header-anchor">#</a> （3）优化</h5> <p><strong>索引</strong></p> <p>1、尽量覆盖索引，5.6支持索引下推</p> <p>2、组合索引符合最左匹配原则</p> <p>3、避免索引失效</p> <p>4、再写多读少的场景下，可以选择普通索引而不要唯一索引，更新时，普通索引可以使用change buffer进行优化，减少磁盘IO,将更新操作记录到change bufer，等查询来了将数据读到内存再进行修改.</p> <p>5、索引建立原则（一般建在where和order by，基数要大，区分度要高，不要过度索引，外键建索引）</p> <p><strong>sql语句</strong></p> <p>1、分页查询优化</p> <p>该方案适用于主键自增的表，可以把Limit查询转换成某个位置的查询。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_sku <span class="token keyword">where</span> id<span class="token operator">&gt;</span><span class="token number">20000</span> <span class="token keyword">limit</span> <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>2、优化insert语句</p> <ul><li>多条插入语句写成一条</li> <li>在事务中插数据</li> <li>数据有序插入（主键索引）</li></ul> <p><strong>数据库结构优化</strong></p> <p>1、将字段多的表分解成多个表</p> <p>有些字段使用频率高，有些低，数据量大时，会由于使用频率低的存在而变慢，可以考虑分开。</p> <p>2、对于经常联合查询的表，可以考虑建立中间表</p> <p><strong>优化器优化</strong></p> <p>1、优化器使用MRR</p> <p><strong>原理：MRR 【<strong>Multi-Range Read</strong>】将ID或键值读到buffer排序，通过把「随机磁盘读」，转化为「顺序磁盘读」，减少磁盘IO，从而提高了索引查询的性能。</strong></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql <span class="token operator">&gt;</span><span class="token keyword">set</span> optimizer_switch<span class="token operator">=</span><span class="token string">'mrr=on'</span><span class="token punctuation">;</span><span class="token keyword">explain</span> 查看 Extra多了一个MRRexplainselect<span class="token operator">*</span><span class="token keyword">from</span> stu <span class="token keyword">where</span> age <span class="token operator">between</span> <span class="token number">10</span> <span class="token operator">and</span> <span class="token number">20</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>对于 Myisam，在去磁盘获取完整数据之前，会先按照 rowid 排好序，再去顺序的读取磁盘。</p> <p>对于 Innodb，则会按照聚簇索引键值排好序，再顺序的读取聚簇索引。</p> <p>**磁盘预读：**请求一页的数据时，可以把后面几页的数据也一起返回，放到数据缓冲池中，这样如果下次刚好需要下一页的数据，就不再需要到磁盘读取（局部性原理）</p> <p><strong>索引本身就是为了减少磁盘 IO，加快查询，而 MRR，则是把索引减少磁盘 IO 的作用，进一步放大</strong></p> <p>https://zhuanlan.zhihu.com/p/148680235</p> <p><strong>架构优化</strong></p> <p>读/写分离（主库写，从库读）</p> <p><strong>总结：</strong></p> <p>1、先设置慢查询（my.ini或数据库命令）</p> <p>2、分析慢查询日志</p> <p>3、定位低效率sql（show processlist）</p> <p>4、explain分析执行计划（是否索引失效，用到索引没，用了哪些）</p> <p>5、优化（索引+sql语句+数据库结构优化+优化器优化+架构优化）</p> <h2 id="_28-主从同步"><a href="#_28-主从同步" class="header-anchor">#</a> 28 主从同步</h2> <p>主从三条线程+binlog+relaylog(中继日志)</p> <p><strong>原理：</strong></p> <ul><li>binlog会在服务器启动生成，用于记录主库数据库变更记录，当binlog发生变更时，主结点的<strong>log dump</strong>线程会将其内容发给各个从结点，从结点的 IO线程接收binlog内容，并写入relay log(从节点上)，从结点的SQL线程读取relay log内容对数据库数据进行更新重放，保证主从一致性</li></ul> <p><strong>同步问题：</strong></p> <ul><li><strong>全同步复制</strong>：主库强制同步日志到从库，等<strong>全部从库执行完</strong>才返回客户端，性能差</li> <li><strong>半同步复制</strong>：主库收到至少一个从库确认就认为操作成功，从库写入日志成功返回ack确认</li></ul> <h2 id="_29-高可用架构"><a href="#_29-高可用架构" class="header-anchor">#</a> 29 高可用架构</h2> <p>一主一备</p> <p><strong>M-S结构</strong></p> <p><img src="https://cdn.jsdelivr.net/gh/Weibw162/image-hosting@dev/%E5%85%AC%E4%BC%97%E5%8F%B7%E5%9B%BE%E7%89%87/image.5pdz1u7xx600.webp" alt="image"></p> <p>主库A与备库B，客户端操作A，B把更新A的语句同步过来本地执行，数据就一致了，建议将备库设置为只读模式。</p> <p>因为同步更新线程是超级权限不影响，而且设置为只读（1、可以标识哪个为备库2、当需要从备库查询时避免误操作）</p> <p><strong>主备延迟</strong></p> <p>1、解释：同一个事务，备库执行完时间与主库执行完时间之差</p> <p>2、原因：</p> <p>一般情况，日志从主库发到备库造成的时间很短的，主要原因是备库接收完这个binlog执行这个事务造成的时间，所以，主备延迟最直接的表现是，<strong>备库消费中转日志（relay log）的速度，比主库生产binlog的速度要慢。</strong></p> <p>3、主备延迟的来源</p> <ul><li><p>1、主备库部署机器性能差异</p></li> <li><p>2、只考虑主库压力，忽略备库压力，备库写压力大，占用了cpu资源，导致同步延迟</p></li> <li><ul><li><p><strong>解决方案：</strong></p></li> <li><ul><li>1、一主多从，分摊读压力（*）</li> <li>2、通过binlog输出到外部系统，比如Hadoop这类系统，让外部系统提供统计类查询的能力。</li></ul></li></ul></li> <li><p>3、大事务，大事务让主库执行很久，那么到备库也要执行很久，导致延迟很久，比如一次是删很多数据</p></li></ul> <p><strong>主备切换策略</strong>**（<strong>由于有主备延迟，导致有多种切换策略</strong>）**</p> <p>1、可靠性优先策略(实际保证这个)</p> <ul><li><strong>切换流程</strong>：等到主备数据同步再将备库设置为读写，业务转到备库B</li> <li><strong>判断备库B的同步延迟时间（seconds_behind_master）小于某个值时，将主库A设置为只读（readonly=ture）,此时系统会不可用主从都只读，然后继续等备库的同步延迟时间为0了，将B备库设置为读写（readonly=false）,然后业务请求转到B</strong></li> <li><strong>问题</strong>：当主库设置为只读时，此时旧的主备都只读，系统不可用，所以要求备库同步延迟尽量短时才开始切换</li></ul> <p>2、备库并行复制</p> <p><strong>前行知识</strong>：若备库执行日志的速度一直慢于主库生成日志速度，延迟可能会达到小时级别，若主库持续高压力，备库可能始终追追不上主库节奏。采用备库并行复制解决。</p> <p><strong>模型：</strong></p> <p><img src="https://cdn.jsdelivr.net/gh/Weibw162/image-hosting@dev/%E5%85%AC%E4%BC%97%E5%8F%B7%E5%9B%BE%E7%89%87/image.31a58io8onq0.webp" alt="image"></p> <ul><li>1、coordinator负责读取中转日志和分发事务</li> <li>2、各个workers负责真正执行</li> <li>3、workers个数由slave_paralles_wokers决定，一般设置8-16（32核），备库还需要其他查询</li></ul> <p><strong>coordinator分发规则(每个版本须遵守</strong>)</p> <ul><li><p>1、更新同一行的两个事务须分配到同一个worker</p></li> <li><p>2、同一个事务不能拆分，需分配到同一个worker</p></li></ul></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/weibw162/weibw162.github.io/edit/master/docs/06.更多/01.微信公众号文章/002.《面试笔记》——MySQL终结篇（30问与答）.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/tags/?tag=Mysql" title="标签">#Mysql</a><a href="/tags/?tag=%E9%9D%A2%E8%AF%95" title="标签">#面试</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/10/13, 17:39:25</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/b6414a/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">《50000字！数分面试必备数仓知识大全》</div></a> <a href="/pages/e444e7/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">看完这篇 Session、Cookie、Token，和面试官扯皮就没问题了</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/b6414a/" class="prev">《50000字！数分面试必备数仓知识大全》</a></span> <span class="next"><a href="/pages/e444e7/">看完这篇 Session、Cookie、Token，和面试官扯皮就没问题了</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/fa4b28/"><div>牛客网非技术快速入门SQL练习题</div></a> <span>03-08</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/e7a859/"><div>其他日常SQL题</div></a> <span>03-07</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/266896/"><div>用户与权限管理</div></a> <span>03-05</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:weibw162@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/weibw162" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2023
    <span>| Weibw | <a href="https://beian.miit.gov.cn/" target="_blank" style="font-weight:normal">辽ICP备18015889号</a> </span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:1;"></div> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7df3e72d.js" defer></script><script src="/assets/js/2.0f973f23.js" defer></script><script src="/assets/js/3.004d1f99.js" defer></script><script src="/assets/js/41.109d26dd.js" defer></script>
  </body>
</html>
